# Export Config JSON Schema

The export config is a JSON file that describes exactly how to cut and join source videos into a single output file. It is generated by the frontend editor and consumed by the FFmpeg processor.

## Full Example

```json
{
  "version": 1,
  "id": "export-abc123",
  "projectId": "7c98c8d8-e3ab-40f5-ac00-b8bd14b63934",
  "projectName": "My Podcast Episode 12",
  "createdAt": "2026-02-27T11:16:00.000Z",

  "sources": [
    {
      "id": "media-001",
      "name": "Camera 1 - Wide",
      "filePath": "/data/media/camera1_wide.mp4",
      "width": 3840,
      "height": 2160,
      "duration": 3600.5,
      "fps": 30,
      "hasAudio": true
    },
    {
      "id": "media-002",
      "name": "Camera 2 - Close",
      "filePath": "/data/media/camera2_close.mp4",
      "width": 3840,
      "height": 2160,
      "duration": 3600.5,
      "fps": 30,
      "hasAudio": true
    },
    {
      "id": "media-003",
      "name": "Camera 3 - Guest",
      "filePath": "/data/media/camera3_guest.mp4",
      "width": 3840,
      "height": 2160,
      "duration": 3600.5,
      "fps": 30,
      "hasAudio": true
    }
  ],

  "segments": [
    {
      "sourceIndex": 0,
      "startTime": 0.0,
      "endTime": 12.5,
      "audioFromSource": true
    },
    {
      "sourceIndex": 1,
      "startTime": 12.5,
      "endTime": 28.0,
      "audioFromSource": true
    },
    {
      "sourceIndex": 0,
      "startTime": 28.0,
      "endTime": 45.0,
      "audioFromSource": true
    }
  ],

  "output": {
    "filePath": "/data/media/exports/export-abc123.mp4",
    "format": "mp4",
    "width": 3840,
    "height": 2160,
    "fps": 30,
    "codec": "copy",
    "includeAudio": true
  },

  "status": "pending"
}
```

## Field Reference

### Root

| Field | Type | Description |
|-------|------|-------------|
| `version` | `number` | Schema version. Currently `1`. Used for forward compatibility. |
| `id` | `string` | Unique export job ID (generated by frontend). |
| `projectId` | `string` | Editor project ID this export belongs to. |
| `projectName` | `string` | Human-readable project name (used for output filename). |
| `createdAt` | `string` | ISO 8601 timestamp when the config was generated. |
| `sources` | `Source[]` | All source video files referenced by segments. |
| `segments` | `Segment[]` | Ordered list of cuts that make up the final video. |
| `output` | `Output` | Output file settings. |
| `status` | `string` | Job status: `"pending"` \| `"processing"` \| `"completed"` \| `"failed"`. |

### Source

| Field | Type | Description |
|-------|------|-------------|
| `id` | `string` | Media asset ID from the editor. |
| `name` | `string` | Display name of the source file. |
| `filePath` | `string` | Absolute path to the source file on the server. Phase 2: S3 URL. |
| `width` | `number` | Source video width in pixels. |
| `height` | `number` | Source video height in pixels. |
| `duration` | `number` | Source video duration in seconds. |
| `fps` | `number` | Source video frame rate. |
| `hasAudio` | `boolean` | Whether the source file contains an audio track. |

### Segment

Segments are **ordered** — they are concatenated in the order they appear in the array to produce the final output.

| Field | Type | Description |
|-------|------|-------------|
| `sourceIndex` | `number` | Index into the `sources` array identifying which file to cut from. |
| `startTime` | `number` | Start time in the **source file** in seconds. |
| `endTime` | `number` | End time in the **source file** in seconds. |
| `audioFromSource` | `boolean` | If `true`, audio is taken from the same source file. If `false`, the segment is video-only (for future use with external audio tracks). |

**Note:** `startTime` and `endTime` are times within the source file, not the output timeline. The output timeline position is determined by the order and duration of segments.

### Output

| Field | Type | Description |
|-------|------|-------------|
| `filePath` | `string` | Absolute path where the output file will be written. |
| `format` | `string` | Output container format: `"mp4"` or `"webm"`. |
| `width` | `number` | Output width in pixels. |
| `height` | `number` | Output height in pixels. |
| `fps` | `number` | Output frame rate. |
| `codec` | `string` | Video codec: `"copy"` for stream copy (fast), `"h264"` / `"h265"` for re-encoding. |
| `includeAudio` | `boolean` | Whether to include audio in the output. |

### Status Values

| Status | Description |
|--------|-------------|
| `pending` | Config written, waiting for processing. |
| `processing` | FFmpeg is currently processing. |
| `completed` | Export finished successfully. Output file is at `output.filePath`. |
| `failed` | Export failed. Check logs for error details. |

## How Segments Map to Multicam Switch Points

The frontend converts multicam switch points into segments:

```
Switch points:          Segments:
t=0   → Angle 1        [0]  camera1.mp4  0.0 → 12.5
t=12.5 → Angle 2       [1]  camera2.mp4  12.5 → 28.0
t=28.0 → Angle 1       [2]  camera1.mp4  28.0 → 45.0
```

Each switch point creates a new segment. The segment's `startTime`/`endTime` correspond to the same absolute time in the source file (assuming all cameras are synced and started at the same time). If cameras have sync offsets, the `startTime`/`endTime` are adjusted accordingly.

## Future Extensions (not implemented yet)

These fields may be added in future schema versions:

- **`callbackUrl`** — Webhook URL to notify when export completes
- **`audioOverride`** — External audio file to use instead of source audio
- **`transitions`** — Crossfade/dissolve between segments
- **`globalTrim`** — Intro/outro trim on the final output
- **`watermark`** — Overlay image or text on the output
- **`s3Upload`** — Automatically upload result to S3 bucket
